<?phpclass UsersRating {		// How match comments to view	private $limit = 5;		// Wraper for comments	private $wrap;				private $DB;	public function __construct($params) {		$Register = Register::getInstance();		$this->DB = $Register['DB'];		$this->wrap = '<div class="etopu">' . "\n" .						'<img alt="" src="%s">' . "\n" .						'<div class="ttop">' . "\n" .							'%s<br>' . "\n" .							'Репутация: %d<br>' . "\n" .							'Сообщений: %d<br>' . "\n" .						'</div>' . "\n" .					'</div>' . "\n";	}			public function common($params) {		$Register = Register::getInstance();				$output = '';				if (!strpos($params, '{{ users_rating }}')) return $params;				$Cache = new Cache;		$Cache->lifeTime = 600;		if ($Cache->check('pl_users_rating')) {			$users = $Cache->read('pl_users_rating');			$users = unserialize($users);		} else {			$users = $this->DB->select('users', DB_ALL, array(				'order' => '`rating` DESC',				'limit' => $this->limit,			));			//$users = $this->DB->query($sql);			$Cache->write(serialize($users), 'pl_users_rating', array());		}				if (!empty($users)) {			foreach ($users as $key => $user) {				$link = get_link($user['name'], '/users/info/' . $user['id']);				$ava = (file_exists(ROOT . '/sys/avatars/' . $user['id'] . '.jpg')) 				? get_url('/sys/avatars/' . $user['id'] . '.jpg') : get_url('/sys/img/noavatar.png');								$output .= sprintf($this->wrap, $ava, $link, $user['rating'], $user['posts']);			}		}		$output .= 	'<div class="etopu">' . get_link('Весь рейтинг', '/users/index?order=rating') . '</div>';									return str_replace('{{ users_rating }}', $output, $params);	}}